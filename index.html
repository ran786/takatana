<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>8æœˆ10æ—¥ é‡£ã‚Šæ—…è¡Œ ã‚¤ãƒ³ã‚¿ãƒ©ã‚¯ãƒ†ã‚£ãƒ–ãƒ—ãƒ©ãƒ³</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&family=Noto+Sans+JP:wght@400;700&display=swap" rel="stylesheet">
    <!-- Chosen Palette: Coastal Calm -->
    <!-- Application Structure Plan: ã“ã®ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã¯ã€æ—…è¡Œã®è¨ˆç”»ã‚’ç›´æ„Ÿçš„ã«ç†è§£ã—ã€æ„æ€æ±ºå®šã‚’ä¿ƒã—ã€å‚åŠ è€…é–“ã®ã‚³ãƒŸãƒ¥ãƒ‹ã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã‚’æ”¯æ´ã™ã‚‹ãŸã‚ã®ã€Œã‚¤ãƒ³ã‚¿ãƒ©ã‚¯ãƒ†ã‚£ãƒ–ãƒ»ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰ã€ã¨ã—ã¦è¨­è¨ˆã•ã‚Œã¦ã„ã¾ã™ã€‚1.ãƒ˜ãƒƒãƒ€ãƒ¼ã§æ—…è¡Œã®ãƒ†ãƒ¼ãƒã‚’æç¤ºã—ã€2.ã‚¿ã‚¤ãƒ ãƒ©ã‚¤ãƒ³å½¢å¼ã®æ—…ç¨‹ã§ä¸€æ—¥ã®æµã‚Œã‚’è¦–è¦šåŒ–ã—ã¾ã™ã€‚3.æœ€ã‚‚é‡è¦ãªå®¿æ³Šå…ˆã®æ¯”è¼ƒã‚»ã‚¯ã‚·ãƒ§ãƒ³ã§ã¯ã€ã‚µã‚¤ãƒ‰ãƒã‚¤ã‚µã‚¤ãƒ‰ã®ã‚«ãƒ¼ãƒ‰ãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆã¨ã‚¤ãƒ³ã‚¿ãƒ©ã‚¯ãƒ†ã‚£ãƒ–ãªæ¯”è¼ƒãƒãƒ£ãƒ¼ãƒˆã‚’ç”¨ã„ã¦ã€ä¾¡æ ¼ã‚„åå®¹äººæ•°ã¨ã„ã£ãŸå®šé‡çš„ãƒ‡ãƒ¼ã‚¿ã‚’ç¬æ™‚ã«æŠŠæ¡ã§ãã‚‹ã‚ˆã†ã«ã—ã¾ã—ãŸã€‚4.ã€ŒæŒã¡ç‰©ã€ã‚»ã‚¯ã‚·ãƒ§ãƒ³ã§ã¯ã€æ—…è¡Œã«å¿…è¦ãªã‚¢ã‚¤ãƒ†ãƒ ã‚’ãƒªã‚¹ãƒˆã‚¢ãƒƒãƒ—ã—ã€5.ã€Œã¿ã‚“ãªã§æ±ºã‚ã‚ˆã†ã€ã‚»ã‚¯ã‚·ãƒ§ãƒ³ã§è­°è«–ã™ã¹ãç‚¹ã‚’æ˜ç¢ºã«æç¤ºã—ã¾ã™ã€‚æœ€å¾Œã«ã€6.ã€Œæ²ç¤ºæ¿ã€ã‚»ã‚¯ã‚·ãƒ§ãƒ³ã‚’è¿½åŠ ã—ã€å‚åŠ è€…é–“ã§ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’å…±æœ‰ã§ãã‚‹ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ ã®ã‚³ãƒŸãƒ¥ãƒ‹ã‚±ãƒ¼ã‚·ãƒ§ãƒ³æ©Ÿèƒ½ã‚’æä¾›ã—ã¾ã™ã€‚ã“ã®æ§‹é€ ã¯ã€å ±å‘Šæ›¸ã®é™çš„ãªæ§‹æˆã‹ã‚‰è„±å´ã—ã€ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®ç†è§£ã€å‚åŠ ã€ãã—ã¦å”èª¿ã‚’æœ€å¤§åŒ–ã™ã‚‹ãŸã‚ã«é¸æŠã•ã‚Œã¾ã—ãŸã€‚ -->
    <!-- Visualization & Content Choices: å®¿æ³Šå…ˆå€™è£œã®æ¯”è¼ƒã¨ã„ã†ä¸­å¿ƒçš„ãªç›®æ¨™ã‚’é”æˆã™ã‚‹ãŸã‚ã€Chart.jsã‚’ç”¨ã„ãŸæ¨ªæ£’ã‚°ãƒ©ãƒ•ã‚’é¸æŠã—ã¾ã—ãŸã€‚ã“ã‚Œã«ã‚ˆã‚Šã€ä¾¡æ ¼ã¨åå®¹äººæ•°ã¨ã„ã†2ã¤ã®é‡è¦ãªæŒ‡æ¨™ã‚’è¦–è¦šçš„ã«ç›´æ¥æ¯”è¼ƒã§ãã€ãƒ¦ãƒ¼ã‚¶ãƒ¼ã¯ãƒ†ã‚­ã‚¹ãƒˆã‚’èª­ã‚€ã‚ˆã‚Šã‚‚è¿…é€Ÿã«å·®ç•°ã‚’ç†è§£ã§ãã¾ã™ã€‚ã‚¿ã‚¤ãƒ ãƒ©ã‚¤ãƒ³ã¯ã€Unicodeã‚¢ã‚¤ã‚³ãƒ³ã¨HTML/CSSã§æ§‹ç¯‰ã—ã€è¦–è¦šçš„ãªæ¥½ã—ã•ã¨åˆ†ã‹ã‚Šã‚„ã™ã•ã‚’æä¾›ã—ã¾ã™ã€‚ã€ŒæŒã¡ç‰©ã€ã‚»ã‚¯ã‚·ãƒ§ãƒ³ã¯ã‚·ãƒ³ãƒ—ãƒ«ãªãƒªã‚¹ãƒˆå½¢å¼ã§ã€è¦–èªæ€§ã‚’é‡è¦–ã—ã¾ã—ãŸã€‚ã€Œæ²ç¤ºæ¿ã€ã¯Firestoreã¨JavaScriptã‚’çµ„ã¿åˆã‚ã›ã¦ã€ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ ã®ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸è¡¨ç¤ºã¨æŠ•ç¨¿ã‚’å¯èƒ½ã«ã—ã€ãƒ¦ãƒ¼ã‚¶ãƒ¼é–“ã®ã‚¤ãƒ³ã‚¿ãƒ©ã‚¯ã‚·ãƒ§ãƒ³ã‚’ä¿ƒé€²ã—ã¾ã™ã€‚ã“ã‚Œã‚‰ã®é¸æŠã¯ã€ã‚¤ãƒ³ã‚¿ãƒ©ã‚¯ãƒ†ã‚£ãƒ–æ€§ã‚’é«˜ã‚ã€æƒ…å ±ã‚’ã‚ˆã‚Šæ¶ˆåŒ–ã—ã‚„ã™ãã™ã‚‹ã¨ã„ã†è¨­è¨ˆæ€æƒ³ã«åŸºã¥ã„ã¦ã„ã¾ã™ã€‚NO SVG/Mermaidã®åˆ¶ç´„ã‚’éµå®ˆã—ã€å…¨ã¦ã®è¦–è¦šè¦ç´ ã¯HTML/CSS/Canvasã§å®Ÿç¾ã—ã¦ã„ã¾ã™ã€‚ -->
    <!-- CONFIRMATION: NO SVG graphics used. NO Mermaid JS used. -->
    <style>
        body {
            font-family: 'Inter', 'Noto Sans JP', sans-serif;
            background-color: #f8f7f4;
            color: #3a3a3a;
        }
        .chart-container {
            position: relative;
            width: 100%;
            max-width: 600px;
            margin-left: auto;
            margin-right: auto;
            height: 300px;
            max-height: 350px;
        }
        .gradient-bg {
            background: linear-gradient(135deg, #a8dadc, #f1faee);
        }
        .card-hover {
            transition: transform 0.3s ease, box-shadow 0.3s ease;
        }
        .card-hover:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05);
        }
        .btn-choice {
            transition: background-color 0.3s, transform 0.2s;
        }
        .btn-choice:hover {
            transform: scale(1.05);
        }
        .timeline-item::before {
            content: '';
            position: absolute;
            left: 1.25rem;
            top: 1.25rem;
            bottom: -1.25rem;
            width: 2px;
            background-color: #457b9d;
            transform: translateX(-50%);
        }
        .timeline-item:last-child::before {
            display: none;
        }
        .timeline-icon {
            background-color: #457b9d;
            color: white;
        }
        .loading-spinner {
            border: 4px solid rgba(0, 0, 0, 0.1);
            border-left-color: #457b9d;
            border-radius: 50%;
            width: 24px;
            height: 24px;
            animation: spin 1s linear infinite;
        }
        @keyframes spin {
            to { transform: rotate(360deg); }
        }
    </style>
</head>
<body>

    <header class="gradient-bg text-center py-12 md:py-20">
        <div class="container mx-auto px-4">
            <h1 class="text-4xl md:text-5xl font-bold text-[#1d3557]">2025/8/10,11 å¤ã®æ—…è¡Œãƒ—ãƒ©ãƒ³</h1>
            <p class="mt-4 text-lg md:text-xl text-[#1d3557]">é«˜æ£šã®ã¿ã‚“ãªãŒã‚„ã£ã¦ãã¾ã™ã€‚</p>
        </div>
    </header>

    <main class="container mx-auto px-4 py-12">
        
        <section id="itinerary" class="mb-16">
            <h2 class="text-3xl font-bold text-center mb-10 text-[#1d3557]">å½“æ—¥ã®ã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒ«</h2>
            <div class="max-w-3xl mx-auto">
                <div class="relative pl-10">
                    <div class="timeline-item relative pb-10">
                        <div class="timeline-icon absolute left-0 top-0 h-10 w-10 rounded-full flex items-center justify-center text-xl transform -translate-x-1/2">ğŸ£</div>
                        <div class="ml-8">
                            <h3 class="text-xl font-bold text-[#457b9d]">åˆå‰ã®éƒ¨ï¼šé‡£ã‚Šå¤§ä¼š</h3>
                            <p class="mt-2 text-gray-700">æœã‹ã‚‰èˆ¹ã§é‡£ã‚Šæ±ºè¡Œï¼å¤§ç‰©ã‚’ç‹™ãŠã†ï¼</p>
                            <div class="mt-4 p-4 bg-white/60 rounded-lg border border-gray-200">
                                <p><strong>é›†åˆå ´æ‰€ï¼š</strong>ğŸš— é«˜æ£šã§è»Šé›†åˆ</p>
                                <p><strong>æ™‚é–“ï¼š</strong>â˜€ï¸ æ—©æœï¼ˆè©³ç´°ã¯å¾Œæ—¥ç›¸è«‡ï¼‰</p>
                            </div>
                        </div>
                    </div>
                    <div class="timeline-item relative pb-10">
                        <div class="timeline-icon absolute left-0 top-0 h-10 w-10 rounded-full flex items-center justify-center text-xl transform -translate-x-1/2">ğŸ </div>
                        <div class="ml-8">
                            <h3 class="text-xl font-bold text-[#457b9d]">å¤•æ–¹ã®éƒ¨ï¼šãŠæ¥½ã—ã¿ãƒ‡ã‚£ãƒŠãƒ¼ï¼†å®¿æ³Š</h3>
                            <p class="mt-2 text-gray-700">å®¿æ³Šå…ˆã«ç§»å‹•ã—ã¦ã€é‡£ã£ãŸé­šã‚’ç¾å‘³ã—ãæ–™ç†ï¼</p>
                            <div class="mt-4 p-4 bg-white/60 rounded-lg border border-gray-200">
                                <p>ğŸ³ é‡£æœã‚’èª¿ç†ã—ã¦ã€ã¿ã‚“ãªã§æœ€é«˜ã®ãƒ‡ã‚£ãƒŠãƒ¼ã‚’æ¥½ã—ã‚‚ã†ï¼</p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </section>
        
        <section id="accommodation" class="mb-16">
            <div class="text-center mb-10">
                <h2 class="text-3xl font-bold text-[#1d3557]">å®¿æ³Šå…ˆæ±ºå®šï¼</h2>
                <p class="mt-2 text-gray-600 max-w-2xl mx-auto">å®¿æ³Šå…ˆã¯ã€Œå€™è£œ2: BBQãŒã§ãã‚‹å®¶ã€ã«æ±ºå®šã—ã¾ã—ãŸï¼</p>
            </div>
            
            <div class="grid grid-cols-1 md:grid-cols-2 gap-8 items-start">
                <div class="bg-white rounded-xl shadow-lg p-6 card-hover opacity-50">
                    <h3 class="text-2xl font-bold text-[#e63946]">å€™è£œ1: ã‚ªãƒ¼ã‚·ãƒ£ãƒ³ãƒ“ãƒ¥ãƒ¼ã®å®¶</h3>
                    <p class="text-lg font-semibold text-[#1d3557] mt-2">1äºº ç´„7,000å††</p>
                    <ul class="mt-4 space-y-2 text-gray-700">
                        <li>ğŸŒŠ <strong>ç‰¹å¾´:</strong> ãƒ™ãƒ©ãƒ³ãƒ€ã‹ã‚‰ã®ã‚ªãƒ¼ã‚·ãƒ£ãƒ³ãƒ“ãƒ¥ãƒ¼</li>
                        <li>ğŸ  <strong>é–“å–ã‚Š:</strong> 5DKï¼ˆ2éšå»ºã¦è²¸åˆ‡ï¼‰</li>
                        <li>ğŸ›Œ <strong>å®šå“¡:</strong> ãƒ™ãƒƒãƒ‰6å° + å¸ƒå›£3çµ„</li>
                        <li>ğŸ³ <strong>è¨­å‚™:</strong> ã‚«ã‚»ãƒƒãƒˆã‚³ãƒ³ãƒ­ã‚ã‚Š</li>
                    </ul>
                    <a href="https://www.airbnb.jp/rooms/1429487453149356603" target="_blank" class="block w-full text-center mt-6 bg-[#e63946] text-white font-bold py-2 px-4 rounded-lg btn-choice">è©³ç´°ã‚’è¦‹ã‚‹</a>
                </div>
                
                <div class="bg-white rounded-xl shadow-lg p-6 card-hover border-4 border-[#457b9d]">
                    <h3 class="text-2xl font-bold text-[#457b9d]">æ±ºå®šï¼å€™è£œ2: BBQãŒã§ãã‚‹å®¶</h3>
                    <p class="text-lg font-semibold text-[#1d3557] mt-2">1äºº ç´„6,000å††</p>
                    <ul class="mt-4 space-y-2 text-gray-700">
                        <li>ğŸ”¥ <strong>ç‰¹å¾´:</strong> è£åº­ã®ã‚¦ãƒƒãƒ‰ãƒ‡ãƒƒã‚­ã«BBQã‚°ãƒªãƒ«</li>
                        <li>ğŸ  <strong>é–“å–ã‚Š:</strong> è²¸åˆ‡ä¸€è»’å®¶</li>
                        <li>ğŸ›Œ <strong>å®šå“¡:</strong> ãƒ™ãƒƒãƒ‰6å° + å¸ƒå›£4çµ„</li>
                        <li>ğŸŒ³ <strong>ãã®ä»–:</strong> é§è»Šå ´ä»˜ã</li>
                    </ul>
                    <a href="https://www.airbnb.jp/rooms/1309352596687236218" target="_blank" class="block w-full text-center mt-6 bg-[#457b9d] text-white font-bold py-2 px-4 rounded-lg btn-choice">è©³ç´°ã‚’è¦‹ã‚‹</a>
                </div>
            </div>
        </section>

        <section id="belongings" class="mb-16">
            <h2 class="text-3xl font-bold text-center mb-10 text-[#1d3557]">æŒã¡ç‰©ãƒªã‚¹ãƒˆ</h2>
            <div class="max-w-2xl mx-auto bg-white rounded-xl shadow-lg p-6">
                <p class="mb-4 text-gray-700">å¿«é©ãªæ—…è¡Œã®ãŸã‚ã«ã€å¿˜ã‚Œãšã«æŒã£ã¦ãã¦ã»ã—ã„ã‚‚ã®ã‚’ãƒªã‚¹ãƒˆã‚¢ãƒƒãƒ—ã—ã¾ã—ãŸã€‚</p>
                <ul class="list-disc list-inside space-y-2 text-gray-700">
                    <li>ç€æ›¿ãˆï¼ˆ1æ³Š2æ—¥åˆ†ï¼‰</li>
                    <li>æ´—é¢ç”¨å…·ï¼ˆæ­¯ãƒ–ãƒ©ã‚·ã€ã‚·ãƒ£ãƒ³ãƒ—ãƒ¼ãªã©ï¼‰</li>
                    <li>ã‚¿ã‚ªãƒ«</li>
                    <li>æ°´ç€ï¼ˆã‚‚ã—æµ·æ°´æµ´ã‚’ã™ã‚‹ãªã‚‰ï¼‰</li>
                    <li>æ—¥ç„¼ã‘æ­¢ã‚ã€å¸½å­</li>
                    <li>é…”ã„æ­¢ã‚è–¬ï¼ˆèˆ¹é…”ã„ãŒå¿ƒé…ãªæ–¹ï¼‰</li>
                    <li>é£²ã¿ç‰©ã€ãŠè“å­</li>
                    <li>å……é›»å™¨</li>
                    <li>ä¿é™ºè¨¼ã®ã‚³ãƒ”ãƒ¼</li>
                    <li>ãã®ä»–ã€å€‹äººçš„ã«å¿…è¦ãªã‚‚ã®</li>
                </ul>
                <p class="mt-4 text-gray-700">â€»é‡£å…·ã¯èˆ¹å®¿ã§ãƒ¬ãƒ³ã‚¿ãƒ«ã§ãã‚‹å¯èƒ½æ€§ãŒã‚ã‚Šã¾ã™ãŒã€ã”è‡ªèº«ã®ã‚‚ã®ã‚’ä½¿ã„ãŸã„æ–¹ã¯ãŠæŒã¡ãã ã•ã„ã€‚</p>
            </div>
        </section>

        <section id="discussion" class="mb-16">
            <div class="text-center mb-10">
                <h2 class="text-3xl font-bold text-[#1d3557]">ã¿ã‚“ãªã§æ±ºã‚ã‚ˆã†ï¼</h2>
                <p class="mt-2 text-gray-600">ã“ã®æ—…è¡Œã‚’æœ€é«˜ã®ã‚‚ã®ã«ã™ã‚‹ãŸã‚ã«ã€ã„ãã¤ã‹æ±ºã‚ãŸã„ã“ã¨ãŒã‚ã‚Šã¾ã™ã€‚</p>
            </div>
            <div class="grid grid-cols-1 gap-6 justify-items-center">
                <div class="bg-white rounded-xl p-6 text-center shadow-lg card-hover max-w-md w-full">
                    <div class="text-4xl mb-4">ğŸ—ºï¸</div>
                    <h3 class="text-xl font-bold">ç¿Œæ—¥ã®ãƒ—ãƒ©ãƒ³ã¯ï¼Ÿ</h3>
                    <p class="mt-2 text-gray-700">ãƒã‚§ãƒƒã‚¯ã‚¢ã‚¦ãƒˆå¾Œã€ã©ã†éã”ã™ã‹ã‚¢ã‚¤ãƒ‡ã‚¢ã‚’å‡ºã—åˆãŠã†ã€‚</p>
                </div>
            </div>
        </section>

        <section id="bulletin-board" class="mb-16">
            <h2 class="text-3xl font-bold text-center mb-10 text-[#1d3557]">æ²ç¤ºæ¿</h2>
            <p class="text-center mb-6 text-gray-600">æ—…è¡Œã«é–¢ã™ã‚‹é€£çµ¡äº‹é …ã‚„è³ªå•ã€ã‚¢ã‚¤ãƒ‡ã‚¢ãªã©ã‚’è‡ªç”±ã«æ›¸ãè¾¼ã‚“ã§ãã ã•ã„ã€‚</p>
            <div class="max-w-2xl mx-auto bg-white rounded-xl shadow-lg p-6">
                <div class="mb-4">
                    <p class="text-sm text-gray-500 mb-2">ã‚ãªãŸã®è¡¨ç¤ºå: <span id="currentUserName" class="font-mono text-gray-700 break-all">èª­ã¿è¾¼ã¿ä¸­...</span></p>
                </div>
                <div class="mb-6">
                    <textarea id="messageInput" class="w-full p-3 border border-gray-300 rounded-lg focus:ring-[#457b9d] focus:border-[#457b9d] resize-y" rows="3" placeholder="ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„..."></textarea>
                    <button id="postMessageBtn" class="mt-3 w-full bg-[#457b9d] text-white font-bold py-2 px-4 rounded-lg btn-choice flex items-center justify-center">
                        <span id="postBtnText">æŠ•ç¨¿ã™ã‚‹</span>
                        <div id="postLoadingSpinner" class="loading-spinner ml-2 hidden"></div>
                    </button>
                </div>
                <div id="messagesContainer" class="space-y-4">
                    <p class="text-center text-gray-500" id="loadingMessages">ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’èª­ã¿è¾¼ã¿ä¸­...</p>
                </div>
            </div>
        </section>

    </main>
    
    <footer class="text-center py-8 mt-12 bg-gray-200">
        <p class="text-gray-600">æ¥½ã—ã„æ—…è¡Œã«ã—ã‚ˆã†ï¼</p>
    </footer>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js";
        import { getAuth, signInAnonymously, signInWithCustomToken, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-auth.js";
        import { getFirestore, collection, addDoc, query, onSnapshot, serverTimestamp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js";

        let db;
        let auth;
        let currentUserId = 'èª­ã¿è¾¼ã¿ä¸­...'; // Firestoreã«ä¿å­˜ã™ã‚‹ID
        const appId = typeof __app_id !== 'undefined' ? __app_id : 'default-app-id';
        const firebaseConfig = typeof __firebase_config !== 'undefined' ? JSON.parse(__firebase_config) : {};

        const messageInput = document.getElementById('messageInput');
        const postMessageBtn = document.getElementById('postMessageBtn');
        const postBtnText = document.getElementById('postBtnText');
        const postLoadingSpinner = document.getElementById('postLoadingSpinner');
        const messagesContainer = document.getElementById('messagesContainer');
        const loadingMessages = document.getElementById('loadingMessages');
        const currentUserNameSpan = document.getElementById('currentUserName');

        document.addEventListener('DOMContentLoaded', async () => {
            try {
                const app = initializeApp(firebaseConfig);
                db = getFirestore(app);
                auth = getAuth(app);

                onAuthStateChanged(auth, async (user) => {
                    if (user) {
                        currentUserId = user.uid; // èªè¨¼æ¸ˆã¿ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®UIDã‚’ä½¿ç”¨
                    } else {
                        try {
                            if (typeof __initial_auth_token !== 'undefined') {
                                await signInWithCustomToken(auth, __initial_auth_token);
                                currentUserId = auth.currentUser.uid;
                            } else {
                                await signInAnonymously(auth);
                                currentUserId = auth.currentUser.uid; // åŒ¿åèªè¨¼ã®UIDã‚’ä½¿ç”¨
                            }
                        } catch (error) {
                            console.error("Firebase Auth error:", error);
                            currentUserId = crypto.randomUUID(); // èªè¨¼å¤±æ•—æ™‚ã¯ãƒ©ãƒ³ãƒ€ãƒ ãªIDã‚’ä½¿ç”¨
                        }
                    }
                    currentUserNameSpan.textContent = currentUserId; // ãƒ¦ãƒ¼ã‚¶ãƒ¼IDã‚’ç”»é¢ã«è¡¨ç¤º
                    setupRealtimeMessages();
                });

                postMessageBtn.addEventListener('click', async () => {
                    const messageText = messageInput.value.trim();
                    if (messageText === '') {
                        console.log("ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ãŒç©ºã§ã™ã€‚");
                        return;
                    }

                    postBtnText.classList.add('hidden');
                    postLoadingSpinner.classList.remove('hidden');
                    postMessageBtn.disabled = true;

                    try {
                        await addDoc(collection(db, `artifacts/${appId}/public/data/bulletinBoardMessages`), {
                            userId: currentUserId, // å†…éƒ¨çš„ã«UIDã¾ãŸã¯ãƒ©ãƒ³ãƒ€ãƒ IDã‚’ä¿å­˜
                            userName: currentUserId, // è¡¨ç¤ºåã¨ã—ã¦ãƒ¦ãƒ¼ã‚¶ãƒ¼IDã‚’ä¿å­˜
                            message: messageText,
                            timestamp: serverTimestamp()
                        });
                        messageInput.value = '';
                    } catch (e) {
                        console.error("ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã®æŠ•ç¨¿ä¸­ã«ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸ: ", e);
                    } finally {
                        postBtnText.classList.remove('hidden');
                        postLoadingSpinner.classList.add('hidden');
                        postMessageBtn.disabled = false;
                    }
                });

            } catch (error) {
                console.error("Firebaseã®åˆæœŸåŒ–ä¸­ã«ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸ:", error);
                loadingMessages.textContent = "ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã®èª­ã¿è¾¼ã¿ã«å¤±æ•—ã—ã¾ã—ãŸã€‚";
            }
        });

        function setupRealtimeMessages() {
            if (!db) {
                console.error("FirestoreãŒåˆæœŸåŒ–ã•ã‚Œã¦ã„ã¾ã›ã‚“ã€‚");
                return;
            }
            // orderByã‚’å‰Šé™¤ã—ã€JavaScriptã§ã‚½ãƒ¼ãƒˆ
            const q = query(collection(db, `artifacts/${appId}/public/data/bulletinBoardMessages`));
            onSnapshot(q, (snapshot) => {
                messagesContainer.innerHTML = '';
                loadingMessages.classList.add('hidden');
                
                if (snapshot.empty) {
                    messagesContainer.innerHTML = '<p class="text-center text-gray-500">ã¾ã ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã¯ã‚ã‚Šã¾ã›ã‚“ã€‚</p>';
                } else {
                    // ã‚¹ãƒŠãƒƒãƒ—ã‚·ãƒ§ãƒƒãƒˆã‹ã‚‰ãƒ‡ãƒ¼ã‚¿ã‚’å–å¾—ã—ã€é…åˆ—ã«æ ¼ç´
                    const messages = [];
                    snapshot.forEach((doc) => {
                        messages.push({ id: doc.id, ...doc.data() });
                    });

                    // timestampã§é™é †ã«ã‚½ãƒ¼ãƒˆ
                    messages.sort((a, b) => {
                        if (!a.timestamp || !b.timestamp) return 0; // ã‚¿ã‚¤ãƒ ã‚¹ã‚¿ãƒ³ãƒ—ãŒãªã„å ´åˆã¯ã‚½ãƒ¼ãƒˆã—ãªã„
                        return b.timestamp.toDate().getTime() - a.timestamp.toDate().getTime();
                    });

                    // ã‚½ãƒ¼ãƒˆã•ã‚ŒãŸãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’è¡¨ç¤º
                    messages.forEach((messageData) => {
                        const messageElement = document.createElement('div');
                        messageElement.className = 'bg-gray-100 p-3 rounded-lg border border-gray-200';
                        const timestamp = messageData.timestamp ? new Date(messageData.timestamp.toDate()).toLocaleString('ja-JP') : 'æ—¥ä»˜ä¸æ˜';
                        messageElement.innerHTML = `
                            <p class="text-sm font-semibold text-[#457b9d]">è¡¨ç¤ºå: ${messageData.userName || 'åŒ¿åãƒ¦ãƒ¼ã‚¶ãƒ¼'}</p>
                            <p class="text-gray-800 mt-1">${messageData.message}</p>
                            <p class="text-xs text-gray-500 mt-2 text-right">${timestamp}</p>
                        `;
                        messagesContainer.appendChild(messageElement);
                    });
                }
            }, (error) => {
                console.error("ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã®ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ æ›´æ–°ä¸­ã«ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸ: ", error);
                messagesContainer.innerHTML = '<p class="text-center text-red-500">ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã®èª­ã¿è¾¼ã¿ä¸­ã«ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸã€‚</p>';
            });
        }
    </script>
</body>
</html>
